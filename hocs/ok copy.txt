import { useRouter } from "next/navigation";
import React, { useEffect, useRef, useState } from "react";

type Props = {
  [key: string]: any;
};

function pageLayout(
  WrappedComponent: React.ComponentType<Props>,
  bannerImg?: string
) {
  function HOC(props: Props) {
    const router = useRouter();
    const [visibleElement, setVisibleElement] = useState<string | null>(null);
    const observer = useRef<IntersectionObserver | null>(null);

    useEffect(() => {
      const sections = [
        "vBanner",
        "about",
        "import-export",
        "studio",
        "partners",
        "contact",
      ];

      const options = {
        threshold: 0.3,
      };

      const observerCallback = (entries: IntersectionObserverEntry[]) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            if (visibleElement !== entry.target.id) {
              setVisibleElement(entry.target.id);
              console.log("Scrolled to: " + entry.target.id);
              document.getElementById("navLink-" + entry.target.id)?.click();
            }
          }
        });
      };

      observer.current = new IntersectionObserver(observerCallback, options);

      sections.forEach((id) => {
        const element = document.getElementById(id);
        if (element) {
          observer.current?.observe(element);
        }
      });

      return () => {
        observer.current?.disconnect();
      };
    }, []);

    return <WrappedComponent {...props} />;
  }

  return HOC;
}

export default pageLayout;
